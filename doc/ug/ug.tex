\section{Introduction}

\subsection{What is GLIMMER?}

GLIMMER\footnote{GENIE Land-Ice Model with Multiply Enabled
Regions} is the land ice component of GENIE\footnote{Grid-ENabled
Integrated Earth-system model}. Its design is motivated by the desire to
create an ice modelling system which is easy to interface to a wide variety of
climate models, without 
the user having to have a detailed knowledge of its inner workings. This is
accomplished by providing a very well-defined interface, which allow access to
all the functionality required by the user. All model fields and
time-dependent parameters required by the ice model are passed to it through
the argument lists of the supplied subroutines. Initialisation data is
supplied through namelist files, while output is to unformatted binary
files. Currently, a suite of Matlab routines is provided for visualisation,
but these may be replaced in due course.

\subsection{What are `Multiply Enabled Regions'?}

The most distinctive feature of the GLIMMER framework is the ability to
run the ice model over several different regions of the globe, and to define
those regions at runtime. Each specified region is termed an \emph{instance}
of the ice model. Primarily, then, GLIMMER provides a uniform interface
between a global climate model and an arbitrary number of ice models. The
processes of down-scaling input variables, and subsequently aggregating and
up-scaling outputs is handled invisibly by GLIMMER, leaving the user solely
with the tasks of supplying input data and parameters, and handling outputs in
the manner appropriate to the problem being tackled. These techniques could be
applicable to any surface model that you might want to run only over
particular regions of the globe.

\subsection{Can I use GLIMMER with my climate model?}

We hope so! The external interface of GLIMMER is designed to be quite
flexible, but certain assumptions have necessarily been made about the form
taken by input fields, etc. In general, these are derived from the
characteristics of the GENIE climate model, and the Reading IGCM, which is one
of atmospheric models available in GENIE. Nevertheless, the specified input
fields are chosen on the basis of their physical importance, rather than
because of their availability within a given atmospheric model. This may mean
that some pre-processing has to be done before fields may be passed to
GLIMMER, which clearly might have cost implications.

In order to use GLIMMER, the following is necessary:

\begin{itemize}
\item Global input fields must be supplied on a latitude-longitude
  grid. The grid does not have to be uniform in latitude, meaning that
  Gaussian grids may be used. Irregular grids (e.g. icosahedral grids) are not
  supported currently. 
\item The boundaries between global grid boxes should be located halfway
  between adjacent grid-points. This is not strictly true of a Gaussian grid,
  but we make that approximation at the moment. Functionality may be provided
  to deal with this in future versions, however.
\item In the global field arrays, latitude must be indexed from north to south
  -- i.e. the first row of the array is the northern-most one. Again, some
  flexibility might be introduced into this in the future.
\item The global grid must not have grid points at either of the poles.
\item The user must supply the bedrock topography for each of the ice model
  instances. Currently this is read from an unformatted binary file, but it is
  intended to change all file operations to use the NetCDF/CF standard in the
  near future.
\item GLIMMER is written in FORTRAN 90/95, and may currently only be called from
  other FORTRAN code. Work will begin soon on componentization of
  all parts of GENIE, comprising the `wrapping' of components in Java,
  etc. This will make the source language irrelevant, apparently.
\end{itemize}

\section{GLIMMER in practice -- an example}

\subsection{Initialising and calling}

The easiest way to learn how GLIMMER is used is by way of an
example. We assume that the GLIMMER code has been installed alongside the
climate model code, and can be compiled and linked successfully. Details of
how to achieve this may be found in the \texttt{COMPILE} file in the top-level
GLIMMER directory. 

Typically, GLIMMER will be called from the main program body of a
climate model. To make this possible, the compiler needs to be told to use the
GLIMMER code. Use statements appear at the very beginning of f90 program
units, before even \texttt{implicit none}:
%
\begin{verbatim}
  use glimmer_main
\end{verbatim}
%
The next task is to declare a variable of type \texttt{glimmer\_params}, which
holds everything relating to the model, including any number of ice-sheet
instances:
%
\begin{verbatim}
  type(glimmer_params) :: ice_sheet
\end{verbatim}
%
Before the ice-sheet model may be called from the climate model, it must be
initialised. This is done with the following subroutine call:
%
\begin{verbatim}
  call initialise_glimmer(ice_sheet,lats,lons,paramfile)
\end{verbatim}
%
In this call, the arguments are as follows:
%
\begin{itemize}
\item \texttt{ice\_sheet} is the variable of type \texttt{glimmer\_params}
 defined above;
\item \texttt{lats} and \texttt{lons} are one-dimensional arrays giving the
  locations of the global grid-points in latitude and longitude, respectively; 
\item \texttt{paramfile} is the file name of the top-level GLIMMER parameter
  namelist.
\end{itemize}
%
The contents of the namelist files will be dealt with later. Having
initialised the model, it may now be called as part of the main climate
model time-step loop:
%
\begin{verbatim}
    call glimmer(ice_sheet,time,temp,precip,zonwind,merwind,orog)
\end{verbatim} 
%
The arguments given in this example are the compulsory ones only; a number of
optional arguments may be specified -- these are detailed in the reference
section below. The compulsory arguments are:
%
\begin{itemize}
\item \texttt{ice\_sheet} is the variable of type \texttt{glimmer\_params}
 defined above;
\item \texttt{time} is the current model time, in years;
\item \texttt{temp} is the daily mean $2\,\mathrm{m}$ global air temperature field, in
  $^{\circ}\mathrm{C}$;
\item \texttt{precip} is the global daily precipitation fields,
  in $\mathrm{mm}/\mathrm{day}$ (water equivalent, making no distinction
  between rain, snow, etc.);
\item \texttt{zonwind} and \texttt{merwind} are the daily mean global zonal and
  meridional components of the $10\,\mathrm{m}$ wind field, in
  $\mathrm{ms}^{-1}$;
\item \texttt{orog} is the global orography field, in $\mathrm{m}$.
\end{itemize}
%
For the positive degree-day mass-balance routine, which is currently the only
mass-balance model included with GLIMMER, the daily quantities given above are
necessary, and, as such, GLIMMER should be called once per day. With the
energy and mass-balance model currently being developed, hourly calls will be
necessary. 
%
\subsection{Finishing off}
%
After the desired number of time-steps have been run, GLIMMER may have some
tidying up to do. To accomplish this, the subroutine \texttt{end\_glimmer}
must be called:
%
\begin{verbatim}
  call end_glimmer(ice_sheet)
\end{verbatim}
%
\subsection{Namelists}
%
Global parameters, applicable to all instances of the ice model are contained
in the file specified by \texttt{paramfile} in the call to
\texttt{initialise\_glimmer}. An example namelist file is given below (it is
the file \texttt{example.glp}):
%
\begin{verbatim}
&timesteps
tinc = 1.0/
&file_paras
ninst=1/
g_land.gln
\end{verbatim}
%
In FORTRAN, a namelist begins with \texttt{\&}, followed by that namelist's
label, and a list of variable names and their values, separated by either
commas or newlines. Note that not all the members of a namelist need be
present, nor do they have to appear in the order declared in the code. 
The namelist ends with a \texttt{/} character. As you can see, the GLIMMER
parameter namelist file contains two namelists, each containing a single
variable, and ends with a field of plain text (in this case, `\texttt{g\_land.gln}').

The first namelist, \texttt{timesteps} contains the main ice model time-step,
\texttt{tinc}, in years. The second namelist, \texttt{file\_paras} contains
the number of ice model instances, \texttt{ninst}. After the two namelists are
the filenames of the namelists of parameters for each ice model
instance. Thus, there should be a number of filenames equal to the value of \texttt{ninst}.

For each instance of the model, a namelist file with instance-specific
parameters must be supplied. The names of these files are given in the main
GLIMMER namelist, as described above. The namelist file for an individual
instance is fairly long, so only a summary of the different namelists
contained in it is given below. For an example this kind of file, see
\texttt{g\_land.gln} in the Inputs directory.

Namelists in an instance-specific file:
%
\begin{itemize}
\item The first line of the instance-specific file contains the stem to be
  used when constructing output filenames. In the case of the example file
  \texttt{g\_land.gln}, the output stem is \texttt{g\_land}.
\item \texttt{sizs} Model grid parameters -- number of grid points in $x$ and
  $y$ dimensions, and number of levels in the vertical.
\item \texttt{prj} Details of the projection used in the instance -- type of
  projection, and necessary parameters.
\item Next, there follows a field of plain text, specifying the name of a
  sigma-coordinates file (see below)
\item \texttt{opts} Flags specifying various model integration options, such
  as which of various schemes to use, etc.
\item \texttt{nums} Parameters relevant to the model numerics -- time-steps and
  things.
\item \texttt{pars} Physical parameters for the model, such as isostatic
  relaxation timescale.
\item \texttt{outs} Output file parameters.
\item \texttt{dats} Input filenames.
\item \texttt{cons} Constants used by some parts of the model.
\item \texttt{forc} Parameters used by the forcing which may be used to run
  the model in stand-alone mode.
\end{itemize}
%
The contents of the namelist files is likely to be altered in the future, and
they may also be replaced by XML files.
%
\subsection{Other parameter files}
%
There are two other parameter input files that may be needed by an ice model instance. First
is the sigma coordinate file. This is compulsory, and its name is specified in
the instance-specific namelist file. A sigma coordinate file consists of a
list of numbers in ascending order, between 0.0 and 1.0, specifying the
heights of the model levels in sigma space. The number of entries must be the
same as the number of model levels specified. An example file is
\texttt{g\_land.gls}.

The final input file is optional, and specifies which fields to output during
the model run. It consists of two namelists corresponding to a list of input
fields. It is named according to the output file stem given in the
instance-specific namelist, with a \texttt{.glw} extension. Full details this
file are given in the reference section below.
%
\subsection{Input model fields}
%
The model requires at least one field as input -- the height of the bedrock
topography (including bathymetry, if appropriate). This must be supplied as an
unformatted binary file, and the name of file given in the \texttt{dats}
namelist as \texttt{topgfile}. If the bedrock is not in a relaxed state, then
the height of the relaxed topography must also be supplied, and its name
specified in \texttt{relxfile}. If \texttt{relxfile} is set to \texttt{'none'},
then the bedrock is assumed to be relaxed.

A third file which may be supplied to the model instance is specified in
\texttt{usrffile}. This is a binary file specifying the upper surface of the
ice sheet at the start of the run. If it is set to \texttt{'none'}, then it is
assumed that no ice is present.
%
\subsection{Output file naming}
%
Output files are named by taking the output filename stem given in the
instance specific namelist, and adding to it an extension depending on what it
contains. The extensions are as follows:
%
\begin{center}
\begin{tabular}{|c|c|}
\hline
File type & Extension \\
\hline
\hline
\texttt{.gl0} & Time-series output file \\
\hline
\texttt{.gl2} & 2D output file \\
\hline
\texttt{.gl3} & 3D output file \\
\hline
\end{tabular}
\end{center}
%
In addition, GLIMMER may produce a log file called \texttt{glimmer.gll} which
contains miscellaneous diagnostics.
%
\subsection{Input file naming}
%
Although users are under no obligation to do so, it is recommended that
similar naming extensions are used, as follows:
%
\begin{center}
\begin{tabular}{|c|c|}
\hline
File type & Extension \\
\hline
\hline
\texttt{.glp} & Top level GLIMMER namelist file \\
\hline
\texttt{.gln} & Instance-specific namelist file \\
\hline
\texttt{.gls} & Sigma coordinates file \\
\hline
\texttt{.glw} & Configuration file for output \\
\hline
\end{tabular}
\end{center}
%
Currently, there is no naming convention for binary input files.
%
\subsection{Viewing the output}
%
To view output from glimmer, a set of Matlab routines is supplied. Assuming
that you have Matlab configured to search for the \texttt{.m} files in the
right place, the results may be loaded into Matlab using one of the following
functions:
%
\begin{itemize}
\item \texttt{glim0d(pathname,stem);} Returns an array of diagnostic
  data. \emph{Not ready for use yet\ldots}
\item \texttt{glim2d(time,pathname,stem);} Returns a structure containing
  two-dimensional data. For example use, see below.
\item \texttt{glim3d(time,pathname,stem);} Returns a structure containing
  three-dimensional data. \emph{Not ready for use yet\ldots}
\end{itemize}
%
In these function calls:
\begin{itemize}
\item \texttt{pathname} specifies the location of the file
to be read. If the file is in the current working directory, then
\texttt{pathname} should be set to \texttt{'.'}
\item \texttt{stem} is the output filename stem specified in the
  instance-specific namelist file (see above). In the case of the example
  given above, \texttt{stem} would be set to \texttt{'g\_land'}
\item \texttt{time} is the time in years for which data is required.
\end{itemize}
%
For example, the 1000-year two-dimensional fields output by the model when initialised
by the supplied example namelist files may be read into a Matlab structure
\texttt{a} with the command:
%
\begin{verbatim}
>> a=glim2d(1000,'.','g_land');
\end{verbatim}
%
If the function finds corresponding data, it outputs a list of the fields
obtained. A typical list looks like this:
%
\begin{verbatim}
got uq - scale 1000000
got vq - scale 1000000
got df - scale 100000000
got bx - scale 25
got bu - scale 500
got bv - scale 500
got th - scale 2000
got up - scale 2000
got lw - scale 2000
got to - scale 2000
got ac - scale 5
got bm - scale 5
got bw - scale 2000
got at - scale 1
got bt - scale 1
got ar - scale 1
got pc - scale 5
got ab - scale 5
got ds - scale 5
\end{verbatim}
% 
You don't need to worry what the `scale' field means. What
matters is the list of two-letter codes for the model fields now residing in
memory. A full list is given in the reference section below, but in this
example we'll consider \texttt{up}, which is the upper surface height --
i.e. the elevation of the ice surface or the topography where no ice is
present, taking into account the presence of ocean. To plot this upper
surface, either do so with the \texttt{surf} function
%
\begin{verbatim}
>> surf(a.up);
\end{verbatim}
%
or with one of the contour plotting functions:
%
\begin{verbatim}
>> contourf(a.up,20);
\end{verbatim}
%
And that's all there is to it.
%
\subsection{Two-dimensional output files -- Matlab two-letter codes}
%
The two letter variable names contained in the structure returned by
\texttt{glim2d} have the following meanings:
%
\begin{center}
\begin{tabular}{|c|l|c|}
\hline
Code & Description & units \\
\hline
\hline
\texttt{uq} & flux in $x$ direction & $\mathrm{m}^2\mathrm{yr}^{-1}$ \\
\texttt{vq} & flux in $y$ direction & $\mathrm{m}^2\mathrm{yr}^{-1}$ \\
\texttt{df} & apparent diffusivity & $\mathrm{m}^2\mathrm{yr}^{-1}$ \\
\texttt{bx} & basal slip coefficient & $\mathrm{m\,Pa^{-1}\,yr^{-1}}$ \\
\texttt{bu} & basal slip velocity in $x$ direction & $\mathrm{m\,yr^{-1}}$\\
\texttt{bv} & basal slip velocity in $y$ direction & $\mathrm{m\,yr^{-1}}$\\
\texttt{th} & thickness & m \\
\texttt{up} & ice upper surface elevation & m \\
\texttt{lw} & ice lower surface elevation & m \\
\texttt{to} & bedrock topography & m \\
\texttt{ac} & accumulation-ablation rate & $\mathrm{m\,yr^{-1}}$ \\
\texttt{bm} & basal melt rate & $\mathrm{m\,yr^{-1}}$ \\
\texttt{bw} & basal water depth & m \\
\texttt{at} & annual mean air temperature & $^{\circ}\mathrm{C}$ \\
\texttt{bt} & basal ice temperature & $^{\circ}\mathrm{C}$ \\
\texttt{ar} & annual air temperature range & $^{\circ}\mathrm{C}$ \\
\texttt{pc} & precipitation & $\mathrm{m\,yr^{-1}}$ \\
\texttt{ab} & ablation rate & $\mathrm{m\,yr^{-1}}$ \\
\texttt{ds} & rate of upper ice surface elevation change &
$\mathrm{m\,yr^{-1}}$ \\
\hline
\end{tabular}
\end{center}
%
\subsection{Restarts}
%
GLIMMER provides two routines to handle restarts,
\texttt{glimmer\_write\_restart}, and \texttt{glimmer\_read\_restart}. The
former writes the entire model state to a single file, while the latter will
restore the model state from a previously created
file. For example, \texttt{glimmer\_write\_restart} may be called as follows:
%
\begin{verbatim}
  call glimmer_write_restart(ice_sheet,25,'ice_sheet.restart')
\end{verbatim}
%
Here, \texttt{ice\_sheet} is the GLIMMER parameter variable refered to
previously, \texttt{25} is the logical file-unit to use, and
\texttt{'ice\_sheet.restart'} is the filename of the restart file. This
subroutine call may be made at any point, regardless of whether it is intended
to halt the integration imminently, or not. In order to recover the model
state, the following call to \texttt{glimmer\_read\_restart} would be made:
%
\begin{verbatim}
  call glimmer_read_restart(ice_sheet,25,'ice_sheet.restart')
\end{verbatim}
%
The arguments are the same as for the previous call. When restarting from a
file like this, it is not necessary to make a call to
\texttt{initialise\_glimmer}. Note also that there is no alternative restart mechanism
provided within the normal \texttt{glimmer} subroutine call -- all restarts
must be called explicitly.

Note also that \texttt{glimmer\_read\_restart} may not be called if
\texttt{initialise\_glimmer} has been called already. This is because there is
currently no mechanism for \texttt{glimmer\_read\_restart} to know whether the
relevant model arrays have already been allocated. If they have, and
\texttt{glimmer\_read\_restart} tries to reallocate them, a fatal
run-time error will probably be generated. It is hoped to address this problem
in a future release.
%
\section{Namelist files}
%
This section contains information about the contents of the namelist files
used to configure GLIMMER.
%
\subsection{Top-level GLIMMER configuration file}
%
The top-level configuration file contains the following elements in the
following order:
\begin{center}
\begin{tabular}{l}
\texttt{timesteps} namelist \\
\texttt{file\_paras} namelist \\
List of instance-specific configuration files \\
\end{tabular}
\end{center}
%
\subsubsection {Possible \texttt{timesteps} namelist entry}
%
\begin{center}
\begin{tabular}{|c|c|c|l|}
\hline
Name & Type & Default & Description (units) \\
\hline
\hline
\texttt{tinc} & real & 1.0 & Main model time-step (years) \\
\hline
\end{tabular}
\end{center}
%
\subsubsection{Possible \texttt{file\_params} namelist entry}
\begin{center}
\begin{tabular}{|c|c|c|l|}
\hline
Name & Type & Default & Description (units) \\
\hline
\hline
\texttt{ninst} & integer & 1 & Number of ice model instances \\
\hline 
\end{tabular}
\end{center}
%
\subsubsection{List of instance-specific configuration files}
%
These filenames are given relative to the working directory of the climate
model. They must not be longer than 70 characters, though this may be altered
by changing the value of the parameter \texttt{fname\_length} in file
\texttt{glimmer\_global.f90}. The filenames should be given as plain text,
without quotation marks, and separated by newlines. 
%
\subsection{Instance-specific configuration files}
%
The instance-specific configuration files contain the following elements in
the following order:
\begin{center}
\begin{tabular}{l}
Output filename stem \\
\texttt{sizs} namelist \\
\texttt{prj} namelist \\
Name of sigma file \\
\texttt{opts} namelist \\
\texttt{nums} namelist \\
\texttt{pars} namelist \\
\texttt{outs} namelist \\
\texttt{dats} namelist \\
\texttt{cons} namelist \\
\texttt{forc} namelist \\
\end{tabular}
\end{center}
%
\subsubsection{Output filename stem}
%
As noted above, all output files produced by GLIMMER are constructed by
appending standard file extensions onto a user-supplied filename
stem. A different filename stem is required for each model instance. The stem
includes the path relative to the climate model working directory, and may be
no more than 66 characters (70 minus 4), though this may be altered
by changing the value of the parameter \texttt{fname\_length} in file
\texttt{glimmer\_global.f90}.
%
\subsubsection{Possible \texttt{sizs} namelist entries}
%
The \texttt{sizs} namelist specifies the model domain,
and may contain these elements:
%
\begin{center}
\begin{tabular}{|c|c|c|l|}
\hline
Name & Type & Default & Description (units) \\
\hline
\hline
\texttt{ewn} & integer & -- & Number of grid-points in the east-west
direction \\
\texttt{nsn} & integer & -- & Number of grid-points in the north-south
direction \\
\texttt{upn} & integer & 11 & Number of model levels \\
\hline
\end{tabular}
\end{center}
%
\subsubsection{Possible \texttt{prj} namelist entries}
%
The \texttt{prj} namelist specifies the parameters of the map projection, and
may contain these elements:
%
\begin{center}
\begin{tabular}{|c|c|c|l|}
\hline
Name & Type & Default & Description (units) \\
\hline
\hline
\texttt{p\_type} & integer & 1 & Type of projection: \\
 & & & 1) Lambert Equal Area \\
 & & & 2) Spherical polar \\
 & & & 3) Spherical stereographic (oblique) \\
 & & & 4) Spherical stereographic (equatorial) \\
\hline  
\texttt{lonc} & real & -- & Longitide of projection centre (degrees east) \\
\texttt{latc} & real & -- & Latitude of projection centre (degrees)\\
\texttt{cpx} & real & -- & Local $x$-coordinate of projection centre
(grid-points) \\
\texttt{cpy} & real & -- & Local $y$-coordinate of projection centre
(grid-points) \\
\hline
\end{tabular}
\end{center}
%
\subsubsection{Name of sigma file}
%
Conforms to the same rules as other filenames.
%
\subsubsection{Possible \texttt{opts} namelist entries}
%
The \texttt{opts} namelist specifies various ice model options, and may
contain these elements:
%
\begin{center}
\begin{tabular}{|c|c|c|l|}
\hline
Name & Type & Default & Description (units)\\
\hline
\hline
\texttt{whichtemp} & integer & 1 & Method of ice temperature calculation: \\
 & & & 0) Set column to surface air temperature \\
 & & & 1) Do full temperature solution (also finds vertical \\
 & & & velocity and apparent vertical velocity). \\
\hline
\texttt{whichartm} & integer & 3 & Method of calculation of surface air
temperature: \\
 & & & 0) Linear function of surface elevation \\
 & & & 1) Cubic function of distance from domain centre \\
 & & & 2) Linear function of distance from domain centre \\
 & & & 3) Greenland conditions (function of surface elevation \\
 & & & and latitude) including forcing \\
 & & & 4) Antarctic conditions (sea-level air temperature -- \\
 & & & function of position) \\
 & & & 5) Uniform temperature, zero range (temperature set \\
 & & & in \texttt{cons} namelist) \\
 & & & 6) Uniform temperature, corrected for height, zero range. \\
 & & & 7) Use large-scale temperature and range. \\
\hline
\texttt{whichthck} & integer & 4 & Source of initial conditions: \\
 & & & 1) Read from file \\
 & & & 2) Set equal to one time-step of net accumulation \\
 & & & (where positive) \\
 & & & 3) Stepped, linear function of distance \\
 & & & from domain centre \\
 & & & 4) Read from file \\
 & & & 5--7) Unknown \\
\hline
\texttt{whichflwa} & integer & 0 & Method for calculating flow factor $A$:\\
 & & & 0) \emph{Patterson and Budd} relationship \\
 & & & 1) \emph{Patterson and Budd} relationship, \\
 & & & with temperature set to $-10^{\circ}\mathrm{C}$ \\
 & & & 2) Set equal to $1\times 10^{-16}\,\mathrm{yr}^{-1}
\,\mathrm{Pa}^{-n}$ \\
\hline
\end{tabular}
\end{center}
%
% Continuation of this table...
%
\begin{center}
\begin{tabular}{|c|c|c|l|}
\hline
Name & Type & Default & Description (units)\\
\hline
\hline
\texttt{whichisot} & integer & 1 & Bedrock elevation: \\
 & & & 0) Fixed at input values \\
 & & & 1) Local function of ice loading history (ODE) \\
 & & & 2) Local function of ice loading history (ODE) \\
 & & & with flexure \\
\hline 
\texttt{whichslip} & integer & 4 & Horizontal bed velocity: \\
 & & & 0) Linear function of gravitational driving stress \\
 & & & 1--3) Unknown \\
 & & & 4) Set to zero everywhere \\
\hline
\texttt{whichbwat} & integer & 2 & Basal water depth: \\
 & & & 0) Calculated from local basal water balance \\
 & & & 1) as (0), including constant horizontal flow \\
 & & & 2) Set to zero everywhere \\
\hline
\texttt{whichmarn} & integer & 0 & Ice thickness: \\
 & & & 0) Set thickness to zero if relaxed \\
 & & & bedrock is more than certain water depth (??) \\
 & & & 1) Set thickness to zero if floating \\
 & & & 2) No action \\
\hline
\texttt{whichbtrc} & integer & 1 & Basal slip coefficient: \\
 & & & 0) \texttt{tanh} function of basal water depth \\
 & & & 1) Set equal to zero everywhere \\
\hline
\texttt{whichacab} & integer & 2 & Net accumulation: \\
 & & & 0) EISMINT moving margin \\
 & & & 1) PDD mass-balance model [recommended] \\
 & & & 2) Accumulation only \\
\hline
\texttt{whichstrs} & integer & 2 & Stress solution: \\
 & & & 0) Zeroth-order \\
 & & & 1) First-order \\
 & & & 2) Vertically-integrated first-order \\
 & & & 3) No action (use when velocity found elsewhere) \\
\hline
\texttt{whichefvs} & integer & ? & ?? \\
\hline
\texttt{whichbabc} & integer & 0 & Basal boundary condition? \\
 & & & No options!\\
\hline
\texttt{whichevol} & integer & 0 & Thickness evolution method:\\
 & & & 0) Pseudo-diffusion approach \\
 & & & 2) Diffusion approach (also calculates velocities) \\
\hline 
\texttt{whichwvel} & integer & 0 & Vertical velocities: \\
 & & & 0) Usual vertical integration \\
 & & & 1) Vertical integration constrained so that \\
 & & & upper kinematic B.C. obeyed \\
\hline 
\texttt{whichmask} & integer & 0 & ?? \\
\hline
\texttt{whichprecip} & integer & 0 & Source of precipitation:\\
 & & & 0) Uniform precipitation rate (set internally \\
 & & &  at present) \\
 & & & 1) Use large-scale precipitation rate \\
 & & & 2) Use parameterization of \emph{Roe and Lindzen} \\
\hline
\end{tabular}
\end{center}
%
\subsubsection{Possible \texttt{nums} namelist entries}
%
\begin{center}
\begin{tabular}{|c|c|c|l|}
\hline
Name & Type & Default & Description (units)\\
\hline
\hline
\texttt{ntem}    & real & 1 & Length of temperature time-step as \\
 & & & a multiple of main timestep \\
\hline
\texttt{nvel}    & real & 1 & Length of velocity time-step as \\
 & & & a multiple of main time-step\\
\hline
\texttt{niso}    & real & 1 & Length of isostasy time-step as \\
 & & & a multiple of main time-step\\
\hline
\texttt{nout(3)} & real & (1,10,10) & Time between outputs for time-series, \\
 & & & 2D and 3D fields (years)\\
\hline
\texttt{nstr}    & real & & Start-time for 2D and 3D output (years) \\
\hline
\texttt{thklim} & real & 100 & Lower limit for 3D ice calculations (m?) \\
\hline
\texttt{mlimit} & real & -- & ? \\
\hline
\texttt{dew} & real & -- & Horizontal grid spacing in east-west direction (m)
\\
\hline
\texttt{dns} & real & -- & Horizontal grid spacing in north-south direction (m) \\
\hline
\end{tabular}
\end{center}
%
\subsubsection{Possible \texttt{pars} namelist entries}
%
\begin{center}
\begin{tabular}{|c|c|c|l|}
\hline
Name & Type & Default & Description (units)\\
\hline
\hline
\texttt{geot} & real & $-5\times 10^{-2}$ & Geothermal heat flux
($\mathrm{Wm}^{-2}$) \\
\hline
\texttt{fiddle} & real & 3.0 & Multiplier for flow factor \\
\hline
\texttt{airt(2)} & real & (-3.15,-0.01) & Air temperature parameterization
factors \\
 & & & (K, $\mathrm{K}\,\mathrm{km}^{-3}$) \\
\hline
\texttt{nmsb(3)} & real & (0.5, $1.05\times 10^{-5}$,  & Net accumulation
factors used in \\
 & & $4.5\times 10^{5}$) & combination with $\mathtt{whichthck}=2,3$ \\
 & & & ($\mathrm{m}\,\mathrm{yr}^{-1}$, $\mathrm{yr}^{-1}$, m) \\
\hline
\texttt{hydtim} & real & 1000 & 1) Basal hydrology time constant (When \\
 & & & $\mathtt{whichbwat}=0$) (yr)\\
 & & & 2) Basal hydrology advection velocity (When \\
 & & & $\mathtt{whichbwat}=1$) ($\mathrm{m}\,\mathrm{yr}^{-1}$)\\
\hline
\texttt{isotim} & real & 3000 & Isostasy time-constant (used in combination \\
 & & & with \texttt{whichisot} (yr) \\
\hline 
\texttt{bpar(5)} & real & (2.0, 10.0, 10.0, & Basal traction factors (used in \\
 & & 0.0, 1.0) & combination with \texttt{whichbtrc}). These describe the \\
 & & & form of the $B=\tanh(W)$ function: \\
 & & & (1) Width of tanh curve \\
 & & & (2) $W$ at midpoint of tanh curve (m) \\
 & & & (3) $B$ minimum ($\mathrm{m}\,\mathrm{yr}^{-1}\,\mathrm{Pa}^{-1}$) \\
 & & & (4) $B$ maximum ($\mathrm{m}\,\mathrm{yr}^{-1}\,\mathrm{Pa}^{-1}$) \\
 & & & (5) multiplier for marine sediments \\
\hline
\end{tabular}
\end{center}
%
\subsubsection{Possible \texttt{outs} namelist entries}
%
\begin{center}
\begin{tabular}{|c|c|c|l|}
\hline
Name & Type & Default & Description (units)\\
\hline
\hline
\texttt{indices0dx(8)} & integer & (1, 1, \ldots 1) & $x$-coordinates for
time-series output \\
 & & & (grid-points) \\
\hline
\texttt{indices0dy(8)} & integer & (1, 1, \ldots 1) & $y$-coordinates for
time-series output \\
 & & & (grid-points) \\
\hline
\end{tabular}
\end{center}
%
\subsubsection{Possible \texttt{dats} namelist entries}
%
\begin{center}
\begin{tabular}{|c|c|c|l|}
\hline
Name & Type & Default & Description (units)\\
\hline
\hline
\texttt{usrffile} & character & 'none' & Name of file containing initial  \\
 & & & surface elevation (m) \\
\hline
\texttt{topgfile} & character & 'none' & Name of file containing initial \\
 & & & topographic elevation (m) \\
\hline
\texttt{relxfile} & character & 'none' & Name of file containing elevation \\
 & & & of relaxed bedrock topography (m) \\ 
\hline
\end{tabular}
\end{center}
%
\subsubsection{Possible \texttt{cons} namelist entries}
%
\begin{center}
\begin{tabular}{|c|c|c|l|}
\hline
Name & Type & Default & Description (units)\\
\hline
\hline
\texttt{lapse\_rate} & real & -8.0 & Lapse rate used when adjusting \\
 & & & air temperature for elevation ($\mathrm{K}\,\mathrm{km}^{-1}$) \\
\hline
\texttt{precip\_rate} & real & 0.5 & Uniform precipitation rate,
\\
 & & & used in conjuction with \texttt{whichprecip}=0 \\
 & & & ($\mathrm{m}\,\mathrm{yr}^{-1}$ water equivalent) \\
\hline
\texttt{air\_temp} & real & -20.0 & Uniform surface air temperature, \\
 & & & used in conjunction with \texttt{whichsurftemp}=0,1 ($^{\circ}\mathrm{C}$) \\
\hline
\texttt{albedo} & real & 0.4 & Ice albedo \\
\hline
\end{tabular}
\end{center}
%
\subsection{Possible \texttt{forc} namelist entries}
%
\begin{center}
\begin{tabular}{|c|c|c|l|}
\hline
Name & Type & Default & Description (units)\\
\hline
\hline
\texttt{trun} & real & -- & Length of model run (years).\\
 & & & {\bf N.B.} This variable {\em does not} control the length of \\
 & & & the model run --- it is used in the case when \texttt{whichartm}=3 \\
 & & & to tell the forcing initialisation how long the run is going to be. \\
\hline
\end{tabular}
\end{center}

\section{GLIMMER subprogram calls}
%
This section details the subroutine calls provided by GLIMMER, and their
arguments. Note that where a type is given as \texttt{real(rk)}, this
indicates that the kind of the real type is specified by the value of
parameter \texttt{rk}, which may be altered in the file \texttt{glimmer\_globals.f90}.
%
\subsection{Subroutine \texttt{initialise\_glimmer}}
%
\paragraph{Purpose} To initialise the ice model, and load in all relevant parameter files.
%
\paragraph{Name and mandatory arguments}
%
\begin{verbatim}
  subroutine initialise_glimmer(params,lats,longs,paramfile)
\end{verbatim}
%
\paragraph{Arguments}
%
\begin{center}
\begin{tabular}{llll}
\texttt{params}    & \texttt{type(glimmer\_params)} & \texttt{intent(inout)} &
Ice model to be configured \\
\texttt{lats(:)}   & \texttt{real(rk)} & \texttt{intent(in)} & latitudinal location of grid-points in \\
 & & & global data (given in $^{\circ}\mathrm{N}$)\\
\texttt{longs(:)}  & \texttt{real(rk)} & \texttt{intent(in)} & longitudinal location of grid-points in \\
 & & & global data (given in $^{\circ}\mathrm{E}$)\\
\texttt{paramfile} & \texttt{character(*)} & \texttt{intent(in)} & name of
top-level GLIMMER \\
 & & & parameter file \\
\end{tabular}
\end{center}
%
\paragraph{Additional notes}
%
\begin{itemize}
\item The ice model determines the size of the global domain from the sizes of
  the arrays \texttt{lats} and \texttt{longs}.
\item The latitudes contained in \texttt{lats} must be in descending order, so
  that $\mathtt{lats(i)}>\mathtt{lats(i+1)}$ for $1\leq \mathtt{i} \leq
  \mathtt{size(lats)}$.
\end{itemize}
%
\subsection{Subroutine \texttt{glimmer}}
%
\paragraph{Purpose}
%
To perform temporal averaging of input fields, and, if necessary, down-scale
those fields onto local projections and perform an ice model time-step. Output
files may be appended to, and if optional arguments used, fields made
available for feedback.
%
\paragraph{Name and mandatory arguments}
%
\begin{verbatim}
  subroutine glimmer(params,time,temp,precip,zonwind,merwind,orog)
\end{verbatim}
%
\paragraph{Mandatory arguments}
%
\begin{center}
\begin{tabular}{llll}
\texttt{params} & \texttt{type(glimmer\_params)} & \texttt{intent(inout)} &
parameters for this run \\
\texttt{time} & \texttt{real(rk)} & \texttt{intent(in)} & Current model time
(hours) \\
\texttt{temp(:,:)} & \texttt{real(rk)} & \texttt{intent(in)} & Daily mean surface
temperature field ($^{\circ}\mathrm{C}$) \\
\texttt{precip(:,:)} & \texttt{real(rk)} & \texttt{intent(in)} & Daily
precipitation \\
 & & & field (mm/day) \\
\texttt{zonwind(:,:)} & \texttt{real(rk)} & \texttt{intent(in)} & Zonal
component of the wind field \\
 & & & ($\mathrm{ms}^{-1}$) \\
\texttt{merwind(:,:)} & \texttt{real(rk)} & \texttt{intent(in)} & Meridional 
component of the wind \\
 & & & field ($\mathrm{ms}^{-1}$) \\
\texttt{orog(:,:)} & \texttt{real(rk)} & \texttt{intent(in)} & Global orography (m) \\
\end{tabular}
\end{center}
%
\paragraph{Optional arguments}
%
\begin{center}
\begin{tabular}{llll}
\texttt{output\_flag} & \texttt{logical} & \texttt{intent(out)} & Set to show
new output fields have \\
 & & & been calculated after an ice-model time-step. \\
 & & & If this flag is not set, the output fields \\
 & & & retain their values at input. \\
\texttt{orog\_out(:,:)} & \texttt{real(rk)} & \texttt{intent(inout)} & Output
orography (m)\\ 
\texttt{albedo(:,:)} & \texttt{real(rk)} & \texttt{intent(inout)} & Surface
albedo \\
\texttt{ice\_frac(:,:)} & \texttt{real(rk)} & \texttt{intent(inout)} &
Fractional ice coverage \\
\texttt{fw\_flux(:,:)} & \texttt{real(rk)} & \texttt{intent(inout)} & The
fresh-water flux (mm/a) \\
 & & & This is simply the ablation calculated by the \\
 & & & model, scaled up to the global grid. It is up \\
 & & & to the global model to then  deal with it \\
 & & & (route it to the oceans, land scheme, etc.) \\
\end{tabular}
\end{center}
\paragraph{Additional notes}
%
\begin{itemize}
\item The sizes of all two-dimensional fields passed as arguments must be the
  same as that implied by the sizes of the arrays used to pass latitude and
  longitude information when the model was initialised using
  \texttt{initialise\_glimmer}. There is
  currently no checking mechanism in place for this, so using fields of the wrong size
  will lead to unpredictable results.
\item Zonal and meridional components of the wind are only required if the
  small-scale precipitation parameterization is being used (with
  \texttt{whichprecip} set to 2). In other circumstances, \texttt{zonwind} and
  \texttt{merwind} must still be arrays of the correct rank, but need not be
  the correct size, or may be unallocated if desired.
\item The optional output fields only refers to the parts of the globe
  covered by the GLIMMER ice model instances. The fraction of each global
  grid-box covered by ice model instances may be obtained using the
  \texttt{glimmer\_coverage\_map} subroutine below. 
\item The output orography field is given as a mean calculated over the part
  of the grid-box covered by ice  model instances. Thus, to calculate the
  grid-box mean, the output fields should be multiplied point-wise by the
  coverage fraction. 
\item Albedo is currently fixed at 0.4 for ice-covered ground, and set to zero
  elsewhere. The albedo is given for the part of the global grid box covered
  by ice, not as an average of the part covered by the ice model. No attempt
  is made to guess the albedo of the parts of the ice model domain \emph{not}
  covered by ice.
\end{itemize}
%
\paragraph{Example interpretation of output fields}
%
Consider a particular point, $(i,j)$ in the global domain. Suppose value
returned by \texttt{glimmer\_coverage\_map} for this point is 0.7, and the
output fields have these values:
\begin{verbatim}
  orog_out(i,j)  = 200.0
  albedo(i,j)    =   0.4
  ice_frac(i,j)  =   0.5
\end{verbatim}
%
What does this mean? Well, the ice model covers 70\% of the grid-box, and in
that part the mean surface elevation is 200\,m. Of the part covered by the ice
model, half is actually covered by ice. Thus, 35\% ($0.5\times 0.7$) of the global grid-box is
covered by ice, and the ice has an mean albedo of 40\%. The model makes no suggestion for the
albedo or elevation of the other 65\% of the grid-box.
%
\subsection{Subroutine \texttt{end\_glimmer}}
%
\paragraph{Purpose} To perform general tidying-up operations, close files, etc.
%
\paragraph{Name and mandatory arguments}
%
\begin{verbatim}
  subroutine end_glimmer(params)
\end{verbatim}
%
\paragraph{Arguments}
%
\begin{center}
\begin{tabular}{llll}
\texttt{params} & \texttt{type(glimmer\_params)} & \texttt{intent(inout)} & Ice model
parameters \\
\end{tabular}
\end{center}
%
\subsection{Function \texttt{glimmer\_coverage\_map}}
%
\paragraph{Purpose} To obtain a map of fractional coverage of global
grid-boxes by GLIMMER ice model instances. The function returns a value
indicating success, or giving error information.
%
\paragraph{Type, name and mandatory arguments}
%
\begin{verbatim}
  integer function glimmer_coverage_map(params,coverage)
\end{verbatim}
%
\paragraph{Arguments}
%
\begin{center}
\begin{tabular}{llll}
\texttt{params} & \texttt{type(glimmer\_params)} & \texttt{intent(in)} & Ice model parameters \\
\texttt{coverage(:,:)} & \texttt{real(rk)} & \texttt{intent(out)} & Coverage
map \\
\end{tabular}
\end{center}
%
\paragraph{Returned value}
%
\begin{center}
\begin{tabular}{|c|l|}
\hline
Value & Meaning \\
\hline
\hline
0 & Coverage map has been returned successfully \\
1 & Coverage map not yet calculated; must call \texttt{initialise\_glimmer}
first \\
2 & Array \texttt{coverage} is the wrong size \\
\hline
\end{tabular}
\end{center}
%
\subsection{Function \texttt{glimmer\_main\_funit}}
%
\paragraph{Purpose}
%
To return the value of the main logical file unit used by glimmer for writing
and reading files. This unit is used for all read/write operations except for
the glimmer log file (\texttt{glimmer.gll}), which uses a fixed unit (21). The
default value for the unit is 20, but this may be changed at any time, even
when the model is being run.
%
\paragraph{Type, name and mandatory arguments}
%
\begin{verbatim}
  integer glimmer_main_funit(params)
\end{verbatim}
%
\paragraph{Arguments}
%
\begin{center}
\begin{tabular}{llll}
\texttt{params} & \texttt{type(glimmer\_params)} & \texttt{intent(in)} & Ice model parameters \\
\end{tabular}
\end{center}
%
\paragraph{Returned value}
%
The returned value is the logical file unit being used.
%
\subsection{Subroutine \texttt{glimmer\_set\_main\_funit}}
%
\paragraph{Purpose}
%
To set the value of the logical file unit being used by glimmer for writing
and reading files. See previous entry for more details.
%
\paragraph{Name and mandatory arguments}
%
\begin{verbatim}
  glimmer_set_main_funit(params,unit)
\end{verbatim}
%
\paragraph{Arguments}
%
\begin{center}
\begin{tabular}{llll}
\texttt{params} & \texttt{type(glimmer\_params)} & \texttt{intent(inout)} &
Ice model parameters \\
\texttt{unit} & \texttt{integer} & \texttt{intent(in)} & Logical file unit to
be set \\
\end{tabular}
\end{center}
%
\subsection{Subroutine \texttt{glimmer\_write\_restart}}
%
\paragraph{Purpose}
%
To write a restart file containing the whole model state, including all ice
model instances and associated projection data.
%
\paragraph{Name and mandatory arguments}
%
\begin{verbatim}
  glimmer_write_restart(params,unit,filename)
\end{verbatim}
%
\paragraph{Arguments}
%
\begin{center}
\begin{tabular}{llll}
\texttt{params} & \texttt{type(glimmer\_params)} & \texttt{intent(in)} &
Ice model parameters \\
\texttt{unit} & \texttt{integer} & \texttt{intent(in)} & Logical file unit to
use \\
\texttt{filename} & \texttt{character(*)} & \texttt{intent(in)} & Filename to
write \\
\end{tabular}
\end{center}
%
\subsection{Subroutine \texttt{glimmer\_read\_restart}}
%
\paragraph{Purpose}
%
To read a restart file containing the whole model state, including all ice
model instances and associated projection data.
%
\paragraph{Name and mandatory arguments}
%
\begin{verbatim}
  glimmer_read_restart(params,unit,filename)
\end{verbatim}
%
\paragraph{Arguments}
%
\begin{center}
\begin{tabular}{llll}
\texttt{params} & \texttt{type(glimmer\_params)} & \texttt{intent(out)} &
Ice model parameters \\
\texttt{unit} & \texttt{integer} & \texttt{intent(in)} & Logical file unit to
use \\
\texttt{filename} & \texttt{character(*)} & \texttt{intent(in)} & Filename to
read \\
\end{tabular}
\end{center}
